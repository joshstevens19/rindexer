# Token Supply Tracking Example (Global Table)
# Tracks total supply, mints, and burns using a global table
name: TokenSupplyExample
description: Track token supply with mints and burns using global table
repository: https://github.com/joshstevens19/rindexer
project_type: no-code

networks:
  - name: ethereum
    chain_id: 1
    rpc: https://mainnet.gateway.tenderly.co

storage:
  postgres:
    enabled: true
    drop_each_run: true

contracts:
  - name: USDC
    details:
      - network: ethereum
        address: "0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48"
        start_block: "18600000"
        end_block: "18601000"  # ~1000 blocks for testing
    abi: ./abis/ERC20.abi.json
    tables:
      # Global table - one row per network for aggregate counters
      - name: supply_metrics
        global: true
        columns:
          - name: total_supply
            default: "0"
          - name: total_minted
            default: "0"
          - name: total_burned
            default: "0"
          - name: transfer_count
            type: uint64
            default: "0"
        events:
          - event: Transfer
            operations:
              # Mint (from zero address)
              - type: upsert
                if: "$from == 0x0000000000000000000000000000000000000000"
                set:
                  - column: total_supply
                    action: add
                    value: $value
                  - column: total_minted
                    action: add
                    value: $value
                  - column: transfer_count
                    action: increment

              # Burn (to zero address)
              - type: upsert
                if: "$to == 0x0000000000000000000000000000000000000000"
                set:
                  - column: total_supply
                    action: subtract
                    value: $value
                  - column: total_burned
                    action: add
                    value: $value
                  - column: transfer_count
                    action: increment

              # Regular transfer (just count)
              - type: upsert
                if: "$from != 0x0000000000000000000000000000000000000000 && $to != 0x0000000000000000000000000000000000000000"
                set:
                  - column: transfer_count
                    action: increment
