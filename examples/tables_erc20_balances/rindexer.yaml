# ERC20 Token Balances Example
# Tracks holder balances for USDC token
name: ERC20BalancesExample
description: Track ERC20 token balances per holder
repository: https://github.com/joshstevens19/rindexer
project_type: no-code

networks:
  - name: ethereum
    chain_id: 1
    rpc: https://mainnet.gateway.tenderly.co

storage:
  postgres:
    enabled: true

contracts:
  - name: USDC
    details:
      - network: ethereum
        address: "0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48"
        start_block: "18600000"
        end_block: "18601000" # ~1000 blocks for testing
    abi: ./abis/ERC20.abi.json
    tables:
      - name: balances
        columns:
          - name: holder
          - name: balance
            default: "0"
          - name: balance2
            default: "0"
          - name: balance3
            default: "0"
        events:
          - event: Transfer
            operations:
              # Credit the recipient
              - type: upsert
                where:
                  holder: $to
                if: "$to != 0x0000000000000000000000000000000000000000"
                set:
                  - column: balance
                    action: add
                    value: $value
                  - column: balance2
                    action: add
                    value: $value
                  - column: balance3
                    action: add
                    value: $value
              # Debit the sender
              - type: upsert
                where:
                  holder: $from
                if: "$from != 0x0000000000000000000000000000000000000000"
                set:
                  - column: balance
                    action: subtract
                    value: $value
